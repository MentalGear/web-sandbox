<!DOCTYPE html>
<html>
<head>
    <title>Virtual Files Hub</title>
</head>
<body>
    <script>
        // Register SW
        if ('serviceWorker' in navigator) {
            // Register SW with relative path ./sw.ts (served by index.ts)
            // If hub is at /src/virtual-files/hub.html, sw is at /src/virtual-files/sw.ts
            navigator.serviceWorker.register('./sw.ts')
                .then(reg => {
                    console.log("[Hub] SW Registered");
                    if (reg.active) return;
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        console.log("[Hub] SW Activated");
                    });
                })
                .catch(err => console.error("[Hub] SW Registration Failed", err));
        }

        // Listen for messages from Host
        window.addEventListener('message', (event) => {
            if (event.data?.type === 'PUT_FILES') {
                const { sessionId, files } = event.data;
                console.log("[Hub] Received files for", sessionId);

                // Send to SW
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({
                        type: 'PUT_FILES',
                        sessionId,
                        files
                    });
                } else {
                    console.warn("[Hub] SW not ready");
                }
            }
        });
    </script>
</body>
</html>
